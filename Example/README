## Determining the Association Rate Constant of H2O2 to Horseradish peroxidase          
#########################################################################################

  In this example, the association rate constant of hydrogen peroxide (H2O2) to 
  the Horseradish peroxidase (HRP) enzyme is demonstrated. This folder contains
  a basic structure for H2O2 (H2O2.pdb) and HRP (HRP.pdb).

  In the following instructions the variable GEOMBD2DIR will be referenced, and 
  refers to the installation directory of GeomBD2 (/share/apps/GeomBD2 on GPU0).

  You can issue all commands listed here if you export the GEOMBD2DIR environment
  variable on the command line with the following command: 
      export GEOMBD2DIR=/share/apps/GeomBD2



1. Parameterizing the PDB files to the PDBQE format
  The parameterization process takes a PDB coordinate file and converts it to 
  the GeomBD2 PDBQE format. The PDBQE formatted files contain all PDB information
  and additionally includes atomic partial charges and element identifiers.
  This scripts attempts to assign partial charges to all atoms according the
  AMBER14SB forcefield. For charge assignments not supported by the AMBER forcefield,
  charges are assigned by the OpenBabel software.

  Parameterization is performed with the $GEOMBD2DIR/Scripts/parameterize.py script.
  GEOMBD2DIR/Scripts/parameterize.py accepts a PDB formatted file as the command input.
  The PDBQE formatted file will be printed to the console (STDOUT), thus the output 
  must be directed to a file.

  To parameterize the protein and ligand files, issue the following commands:
      $GEOMBD2DIR/Scripts/parameterize.py HRP.pdb > HRP.pdbqe
      $GEOMBD2DIR/Scripts/parameterize.py H2O2.pdb > H2O2.pdbqe

  You will notice several warning messages while paramterizing H2O2. These are to be
  expected, and are typical of the OpenBabel charge assignment process.



2. Pre-calculating Intermolecular Interactions
  Potential grids are created for GeomBD2 simulations to accelerate simulations.
  The Gridder programs of GeomBD2 are used to create these grids. They are parallel
  programs that can speed up grid calculations by using multiple processors.

  The electrostatic potential surrounding the protein receptor is calculated using
  the $GEOMBD2DIR/bin/Gridder-ES command. The Gridder-ES command accepts three arguments:
    -n NPROCS          -- This arguments specifies the number of processors to use
    -r RECEPTOR.pdbqe  -- This specifies the receptor PDBQE file
    -s SPACING         -- This specifies the grid spacing (in Angstroms)

  Execute the following command to generate the electrostatic potential grid over
  10 processors with a grid spacing of 1 Angstrom:
      $GEOMBD2DIR/bin/Gridder-ES -n 10 -r HRP.pdbqe -s 1

  After the command is complete, a new file called "e.bpm" is generated that contains
  electrostatic potential information around the HRP enzyme.


  In addition to the electrostatic grid, we must also create a grid that prevents the
  H2O2 molecule from penetrating into the HRP enzyme molecule. There are two ways to do
  this with GeomBD2. The first is to create an "exclusion grid" that specifies areas of 
  simulation space that are inaccesible to the ligand during its diffusion process.
  This type of grid is created with the $GEOMBD2DIR/bin/Gridder-EX command. It requires
  a forcefield file, and several confiurable parameters to create this type of grid:
    -n NPROCS          -- This arguments specifies the number of processors to use
    -r RECEPTOR.pdbqe  -- This specifies the receptor PDBQE file
    -s SPACING         -- This specifies the grid spacing (in Angstroms)
    -f FORCEFIELD.ff   -- Forcefield file that contains atomic radius information.
    -p PADDING         -- The amount of space surrounding the enzyme

  Create and exclusion grid for HRP using the following command:
      $GEOMBD2DIR/bin/Gridder-EX -d $GEOMBD2DIR/Parameters/AMBER.ff -n 10 -r HRP.pdbqe -p 5 -s 0.2

  After the command is complete, a new file called "x.spm" is generated that contains
  the exclusion map that prevents a ligand from entering the molecular volume of HRP.

  The second way to prevent penetration of molecules is to define Lennard-Jones (LJ) interaction
  potential energy grids. These types of grids describe the atom-specific interactions between
  ligands and receptors. The LJ potential contains terms for both attraction and repulsion.
  This approach consumes more memory during simulations because a grid must be generated 
  for each type of atom in the ligand molecule. For example, in the 
  HRP-H2O2 system, the H2O2 ligand contains Oxygen and Hydrogen atoms. Thus, LJ grids must
  be calculated for the interaction of Hydrogen atoms with the HRP enzyme, as well as a grid
  for the interaction of Oxygen atoms with the HRP enzyme. The following are options for 
  this command:
    -n NPROCS          -- This arguments specifies the number of processors to use
    -r RECEPTOR.pdbqe  -- This specifies the receptor PDBQE file
    -l LIGAND.pdbqe    -- This specifies the ligand PDBQE file
    -s SPACING         -- This specifies the grid spacing (in Angstroms)
    -f FORCEFIELD.ff   -- Forcefield file that contains atomic radius information.
    -p PADDING         -- The amount of space surrounding the enzyme

  To create LJ grids for H2O2 and HRP, issue the following command:
      $GEOMBD2DIR/bin/Gridder-LJ -d $GEOMBD2DIR/Parameters/AMBER.ff -n 10 -r HRP.pdbqe -l H2O2.pdbqe -p 15 -s 0.1

  After the command is complete, new files called "O.bpm" and "H.bpm" are generated that 
  contain electrostatic potential energy values for the interaction of each atom type with
  the HRP protein receptor.



3. Running the simulation
  The simulation of the association of H2O2 to HRP is dictated by an "input file". This
  describes several properties of the system, such as the ligand and receptors PDBQE files,
  the pre-calculated grids to be used, and the parameters of the association simulation such
  as the B and Q spheres.

  An example GeomBD2 input file is provided as "GBD2.in".

  In its current state, the GBD2.in file specifies use of the electrostatic grid ("e.bpm")
  and the exclusion grid ("x.spm"). The lines in the input file that specify use of the
  LJ grids ("O.bpm" and "H.bpm") are commented out with the hash character (#).

  First try running a simulation with the electrostatic and exclusion grids:
     $GEOMBD2DIR/bin/GeomBD2 -f GBD2.in -o H2O2_HRP_ex.pqr -n 10 > H2O2_HRP_ex.log 

  The "H2O2_HRP_ex.log" is a log file that records all information about the simulation 
  while it is running, thus you can check this file to see how the simulation is proceeding.
  The program periodically reports the current estimate of the association rate constant.
  This will run the simulation over 10 processors, and may take up to 12 hours for
  the association rate constant to converge.

  Once this is complete, try modifying the input file. Comment out the use of the 
  exclusion grid by putting a hash character (#) in front of the "grid ex x.spm" line.
  Next, remove the hash characters from the lines specifying the LJ grids.
  Now try to rerun the simulation with the LJ grids instead of the exclusion grid:
     $GEOMBD2DIR/bin/GeomBD2 -f GBD2.in -o H2O2_HRP_lj.pqr -n 10 > H2O2_HRP_lj.log 


  How do the two simulation results differ?
